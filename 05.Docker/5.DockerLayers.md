# Docker Layers

## What are Docker Layers?

When you build a Docker image, each instruction in your Dockerfile (FROM, COPY, RUN, etc.) creates a layer.

Each layer represents a filesystem change (like installing packages or copying files).

## How it works

Docker builds images in layers, stacking one on top of another.

Layers are cached â€” if nothing changes in a layer, Docker reuses it during rebuilds.

This makes builds faster and saves space.

### Example
FROM node:18-alpine     # Layer 1
WORKDIR /app            # Layer 2
COPY package*.json ./   # Layer 3
RUN npm install         # Layer 4
COPY . .                # Layer 5
CMD ["node", "server.js"] # Layer 6


If you change only your source code, only Layer 5 and onward rebuild.

Earlier layers (like dependencies) are reused from cache.


## In short

Layers = steps in Dockerfile

Cached = faster rebuilds

Shared = smaller images across multiple containers

Final image = all layers merged into one filesystem view

## Visualize

```bash
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
CMD ["node", "server.js"]
```

docker build -t my-node-app .

```bash
[+] Building 30.5s (10/10) FINISHED
 => [internal] load build definition from Dockerfile                           0.0s
 => => transferring dockerfile: 200B                                            0.0s
 => [internal] load .dockerignore                                               0.0s
 => [internal] load metadata for docker.io/library/node:18-alpine               2.5s
 => [1/6] FROM docker.io/library/node:18-alpine@sha256:cf4...                   0.0s
 => [2/6] WORKDIR /app                                                          0.1s
 => [3/6] COPY package*.json ./                                                 0.0s
 => [4/6] RUN npm install                                                      15.2s
 => [5/6] COPY . .                                                              0.2s
 => [6/6] EXPOSE 3000                                                          0.0s
 => exporting to image                                                         12.2s
 => => exporting layers                                                        12.2s
 => => writing image sha256:ab34cdef...                                        0.0s
 => => naming to docker.io/library/my-node-app                                 0.0s

Successfully built ab34cdef...
Successfully tagged my-node-app:latest

```

Each => [n/x] line = one Dockerfile instruction = one layer

Layers are created in sequence and cached for next build.


## Now you change your source code

You edit a few files, like server.js, but not package.json.

docker build -t my-node-app .

```bash
 => [1/6] FROM node:18-alpine                        0.0s  [cached]
 => [2/6] WORKDIR /app                               0.0s  [cached]
 => [3/6] COPY package*.json ./                      0.0s  [cached]
 => [4/6] RUN npm install                            0.0s  [cached]
 => [5/6] COPY . .                                   0.2s
 => [6/6] EXPOSE 3000                                0.0s  [cached]
 => exporting to image                               0.4s

```

Only the last layer (COPY . .) rebuilt because source code changed.


